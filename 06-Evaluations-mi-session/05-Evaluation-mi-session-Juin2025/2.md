# Examen de mi-session (rattrapage)

**Thème :** Déploiement – Jenkins, Git, AWS
**Durée :** 4 heures
**Matériel autorisé :** Documentation en ligne et notes personnelles

---

## Partie 1 – Questions à choix multiples

**Instructions :** Cochez une seule réponse correcte par question, sauf indication contraire.

1. Quelle commande permet d’exécuter un pipeline Jenkins localement à des fins de test (dans un Jenkins installé en local) ?

   * a) `jenkins start pipeline`
   * b) `jenkins-cli run`
   * c) Aucun exécutable direct, on doit pousser ou déclencher dans l’interface Jenkins
   * d) `jenkins runfile Jenkinsfile`

2. Quel type de plugin Jenkins permet de déployer automatiquement dans un environnement AWS ?

   * a) AWS EC2 Plugin
   * b) Amazon S3 Publisher
   * c) AWS CodePipeline Notifier
   * d) Amazon Deployer

3. Quel rôle joue la section `post` dans un `Jenkinsfile` ?

   * a) Définir des variables globales
   * b) Déclencher des étapes conditionnelles après l'échec ou le succès
   * c) Gérer le code source Git
   * d) Lancer le job toutes les nuits

4. Dans AWS, quel service est le plus adapté pour stocker les artefacts d’un build Jenkins ?

   * a) Amazon EC2
   * b) Amazon S3
   * c) Amazon Lambda
   * d) Amazon SNS

5. Quelle stratégie permet de maintenir un `pipeline Jenkins` propre et rapide en production ?

   * a) Garder tous les logs pendant 2 ans
   * b) Déclencher le build manuellement à chaque fois
   * c) Utiliser des agents temporaires avec nettoyage post-exécution
   * d) Éviter les tests pour gagner du temps

6. Quelle ressource n'est pas déployable directement via AWS CloudFormation ?

   * a) Un bucket S3
   * b) Un repository GitHub
   * c) Un rôle IAM
   * d) Une instance EC2

7. Quelle commande permet de forker un dépôt Git distant ?

   * a) `git fork`
   * b) `git remote fork <url>`
   * c) Cela se fait uniquement depuis l’interface (ex : GitHub, GitLab)
   * d) `git copy --remote`

8. Lequel de ces services AWS est considéré comme **serverless** ?

   * a) Amazon EC2
   * b) Amazon RDS
   * c) AWS Lambda
   * d) Amazon EBS

---

## Partie 2 – Réponses ouvertes

9. Quelle est la différence entre les trois niveaux suivants dans Jenkins :

   * **stage**
   * **steps**
   * **agent**
     Expliquez clairement leur rôle dans un pipeline déclaratif.

---

10. Quelle est la différence entre **CodeCommit** et **GitHub** dans un environnement DevOps AWS ? Dans quel cas préféreriez-vous l’un ou l’autre ? Justifiez.

---

11. Pourquoi est-il recommandé d’archiver certains fichiers dans Jenkins après chaque exécution ?
    Donnez deux cas d’usage concrets.

---

12. Complétez le pipeline suivant en YAML en ajoutant l'étape manquante pour exécuter `python main.py` dans un environnement avec `requirements.txt`.

```groovy
pipeline {
  agent any

  stages {
    stage('Install') {
      steps {
        sh 'pip install -r requirements.txt'
      }
    }

    stage('Run') {
      steps {
        // compléter ici
      }
    }

    stage('Archive') {
      steps {
        archiveArtifacts artifacts: '**/*.csv', allowEmptyArchive: true
      }
    }
  }
}
```

---

## Partie 3 – Projet pratique : scraping multi-sources

### Contexte :

Vous disposez d’un projet Python `job_scraper` capable de récupérer des offres d'emploi tech depuis plusieurs sites (AuthenticJobs, Remotive, Python.org, HackerNews, etc.). Le fichier de sortie s’appelle `jobs.csv`.

### Objectif :

Créer un pipeline Jenkins pour :

1. Installer les dépendances Python listées dans `requirements.txt`
2. Exécuter le script Python `main.py`
3. Archiver le fichier `jobs.csv` dans Jenkins

---

### À faire :

* Écrire un `Jenkinsfile` propre et fonctionnel (pipeline déclaratif)
* Exécuter le pipeline dans Jenkins
* Prendre une capture d’écran de Jenkins montrant :

  * Le succès du pipeline
  * Le fichier `jobs.csv` disponible dans les artefacts Jenkins

---

### Bonus :

* Expliquez comment configurer un **webhook GitHub** pour déclencher ce pipeline automatiquement après chaque `push` sur le dépôt distant.

---

### Fichiers fournis :

#### `main.py`

```python
# Résumé : Scraping multi-sources d'offres tech

# (voir version complète dans l’annexe ou le dépôt fourni)
# Exemple : scrape_hackernews(), scrape_python_jobs(), etc.
# Construit un fichier jobs.csv contenant toutes les offres récupérées
```

#### `requirements.txt`

```
requests
beautifulsoup4
lxml
pandas
```


